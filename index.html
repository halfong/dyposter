<html>

<head>
  <title>海报</title>
  <meta charset="utf-8">
  <style type="text/css">
    body {
      background: #f4f4f4;
      padding-top: 6vh;
    }

    .center {
      text-align: center;
      margin: 0 auto;
    }
  </style>
</head>

<body>
  <div id="dyposter" class="center" style="width:88vw;height:88vw;background:#fff;overflow: visible;"></div>
  <p class="center" style="padding-top:60px;font-size:4vw;line-height:5vw;color:#666;">长按保存到手机相册</p>
</body>
<script type="application/javascript" src="./lib/zepto.min.js"></script>
<script type="application/javascript" src="./lib/fabric.min.js"></script>
<script type="application/javascript" src="./dyposter.js"></script>
<script type="application/javascript">

  const exampleData = {
    "config": { "width": 1125, "height": 1800, "backgroundColor": "#CCC" },
    "objects": [
      // { "type": "image", "mode": "cover", "top": 60, "left": 60, "width": 1005, "height": 1005, "centeredScaling": true, "crossOrigin": "anonymous", "src": "https:\/\/bluedge.oss-cn-shenzhen.aliyuncs.com\/static\/shop_cover_default.jpg" },
      // { "type": "image", "top": 0, "left": 0, "width": 1125, "height": 1800, "crossOrigin": "anonymous", "src": "https:\/\/bluedge.oss-cn-shenzhen.aliyuncs.com\/static\/poster-bg.png" },
      { "type": "textbox", "top": 1116, "left": 120, "width": 495, "fontSize": "72", "fontWeight": "400", "splitByGrapheme": true, "text": "\u6cf8\u6cbd\u6e56\u65e0\u6240\u5c0f\u4f4f\u7684\u65c5\u884c\u6536\u85cf" },
      { "type": "textbox", "top": 1116, "left": 120, "width": 495, "fontSize": "72", "fontWeight": "400", "splitByGrapheme": true, "text": "\u6cf8\u6cbd\u6e56\u65e0\u6240\u5c0f\u4f4f\u7684\u65c5\u884c\u6536\u85cf" },
      // { "type": "image", "mode": "cover", "top": 1116, "left": 645, "width": 360, "height": 360, "crossOrigin": "anonymous", "src": "https:\/\/bluedge.oss-cn-shenzhen.aliyuncs.com\/ticket\/wxappQrcode\/blank\/forever\/1c73795e269a46bf99ecbf3b1b8cbe31.png" }
    ]
}

  function getUrlParams() {
    const query = {}
    const args = document.location.search.slice(1).split('&')
    args.forEach(ar => query[ar.split('=')[0]] = ar.split('=')[1])
    return query
  }


  const src = getUrlParams().d

  if (!src) {
    // alert('没有数据源')
    // http://fabricjs.com/fabric-intro-part-1#canvas
    const $poster = new Dyposter('dyposter', exampleData.config)
    $poster.draw(exampleData.objects)
  }
  else {
    $.get(src, function (data) {
      if (status > 300) return alert('数据源错误')
      const $poster = new Dyposter('dyposter', data.config)
      $poster.draw(data.objects)
    })
  }

</script>

</html>